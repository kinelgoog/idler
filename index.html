<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Steam Booster Ultimate</title>
<style>
body{font-family:Arial;background:#1e1e1e;color:#fff;padding:20px;}
h1{text-align:center;margin-bottom:20px;}
.account{background:#2d2d2d;padding:15px;margin:10px 0;border-radius:10px;transition:all 0.3s;}
.account:hover{background:#333;}
.status{padding:5px 10px;border-radius:5px;margin-left:10px;color:#fff;transition:background 0.3s;}
.online{background:#43b581;}
.offline{background:#747f8d;}
.steam_guard{background:#faa61a;}
.error{background:#f04747;}
button{padding:8px 12px;margin:3px;border:none;border-radius:5px;cursor:pointer;color:#fff;}
.start{background:#43b581;}
.stop{background:#f04747;}
input{width:50%;padding:5px;border-radius:3px;margin-right:5px;border:1px solid #444;background:#1e1e1e;color:#fff;}
.log{background:#1e1e1e;padding:5px;margin-top:5px;max-height:150px;overflow:auto;border-radius:5px;font-size:12px;}
.progress-container{background:#444;border-radius:5px;margin:5px 0;height:12px;width:100%;}
.progress-bar{height:12px;border-radius:5px;background:#43b581;width:0%;transition:width 1s;}
</style>
</head>
<body>
<h1>üéÆ Steam Booster Ultimate 10/10++</h1>
<div id="accounts"></div>

<audio id="sound-success" src="https://freesound.org/data/previews/331/331912_3248244-lq.mp3"></audio>
<audio id="sound-error" src="https://freesound.org/data/previews/170/170245_2398407-lq.mp3"></audio>
<audio id="sound-guard" src="https://freesound.org/data/previews/146/146730_2615114-lq.mp3"></audio>

<script>
let accounts={};
const ws=new WebSocket(`ws://${location.host}`);
const soundSuccess=document.getElementById('sound-success');
const soundError=document.getElementById('sound-error');
const soundGuard=document.getElementById('sound-guard');

ws.onmessage=msg=>{
  const data=JSON.parse(msg.data);
  if(data.type==='update'){accounts=data.accounts;renderAccounts();}
};

function renderAccounts(){
  const container=document.getElementById('accounts'); container.innerHTML='';
  for(const id in accounts){
    const acc=accounts[id];
    const div=document.createElement('div'); div.className='account';
    let logs=acc.log.map(l=>`<div style="color:${l.type==='error'?'#f04747':l.type==='warning'?'#faa61a':'#43b581'}">${l.msg}</div>`).join('');
    let hoursHtml=Object.entries(acc.hoursPlayed).map(([gid,h])=>`
      <div>Game ${gid}: ${h.toFixed(2)}h
        <div class="progress-container"><div class="progress-bar" style="width:${Math.min(h/100*100,100)}%"></div></div>
      </div>`).join('');
    div.innerHTML=`
      <strong>${acc.displayName}</strong>
      <span class="status ${acc.status==='steam_guard'?'steam_guard':acc.status==='online'?'online':acc.status==='error'?'error':'offline'}">${acc.status.toUpperCase()}</span>
      ${acc.errorMessage?`<div style="color:#f04747;">–û—à–∏–±–∫–∞: ${acc.errorMessage}</div>`:''}
      <div>${hoursHtml}</div>
      <div class="log">${logs}</div>
      <div>
        <button class="start" onclick="startFarm('${id}')">–°–¢–ê–†–¢</button>
        <button class="stop" onclick="stopFarm('${id}')">–°–¢–û–ü</button>
        ${acc.status==='steam_guard'?`<input id="guard-${id}" placeholder="Steam Guard –∫–æ–¥"><button onclick="submitGuard('${id}')">–í–í–ï–°–¢–ò</button>`:''}
      </div>
    `;
    container.appendChild(div);
    if(acc.status==='online') soundSuccess.play();
    else if(acc.status==='error') soundError.play();
    else if(acc.status==='steam_guard') soundGuard.play();
  }
}

function startFarm(id){fetch(`/api/farm/start/${id}`,{method:'POST'});}
function stopFarm(id){fetch(`/api/farm/stop/${id}`,{method:'POST'});}
function submitGuard(id){const code=document.getElementById(`guard-${id}`).value;fetch(`/api/steam-guard/${id}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({code})}).then(res=>res.json()).then(res=>{if(!res.success) alert(res.error);});}
</script>
</body>
</html>
